<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Producto — Blacksheep by CAVS</title>
  <meta name="description" content="Detalle de producto Blacksheep by CAVS." />
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>

<header class="nav">
  <div class="container nav-inner">
    <a class="brand" href="index.html">
      <span>by CAVS</span><span class="dot">•</span>
    </a>

    <nav class="nav-links">
      <a href="index.html">Inicio</a>
      <a class="active" href="blacksheep.html">Blacksheep</a>
      <a href="black-ivory.html">Black Ivory</a>
      <a href="about.html">Sobre CAVS</a>
      <a href="contact.html">Contacto</a>
    </nav>

    <a class="cta"
       href="https://wa.me/56973765456?text=Hola!%20Te%20escribo%20desde%20la%20web%20by%20CAVS%20para%20hacer%20una%20consulta."
       target="_blank" rel="noopener">
      Contactar
    </a>
  </div>
</header>

<main>
  <section class="section">
    <div class="container">

      <div class="card pad brand-hero">

        <div class="kicker" id="prodCode">—</div>

        <h1 class="h1" id="prodTitle" style="margin-top:10px;">Producto</h1>

        <p class="lead" id="prodDesc" style="max-width:780px; margin: 10px auto 0;">
          —
        </p>

        <!-- Debug chiquitito para cachar al tiro -->
        <p class="small-muted" id="debugLine" style="margin-top:10px;"></p>

      </div>

      <div style="height:18px"></div>

      <!-- GALERÍA -->
      <div class="hscroll" id="gallery" aria-label="Galería de fotos"></div>
      <div class="hscroll-hint">Desliza para ver más imágenes →</div>

      <div style="height:24px"></div>

      <!-- FICHA -->
      <div class="card pad">
        <h2 class="h2" style="margin-bottom:14px;">Ficha técnica</h2>

        <p class="p"><strong>Estado:</strong> <span id="prodStatus">—</span></p>
        <p class="p"><strong>Precio:</strong> <span id="prodPrice">—</span></p>
        <p class="p"><strong>Madera:</strong> <span id="prodWood">—</span></p>
        <p class="p"><strong>Resina:</strong> <span id="prodResin">—</span></p>
        <p class="p"><strong>Medidas:</strong> <span id="prodMeasures">—</span></p>

        <div class="actions" style="justify-content:center; margin-top:22px;">
          <a class="btn" href="blacksheep.html">Volver a Blacksheep</a>

          <a class="btn primary" id="waBtn"
             href="https://wa.me/56973765456"
             target="_blank" rel="noopener">
            Consultar por WhatsApp
          </a>
        </div>
      </div>

    </div>
  </section>
</main>

<footer class="footer">
  <div class="container">
    <div class="row">
      <div>© <span id="year"></span> by CAVS — Cristóbal Aboitiz</div>
      <div class="small-muted">
        <a href="blacksheep.html">Volver a Blacksheep</a>
      </div>
    </div>
  </div>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const DATA_URL = "assets/data/products.json";
  const IMG_BASE = "assets/img/tablas/";

  const params = new URLSearchParams(location.search);
  const idRaw = params.get("id");
  const id = idRaw ? idRaw.trim() : "";

  const formatCLP = (n) =>
    "$" + new Intl.NumberFormat("es-CL").format(n);

  function renderGallery(images){
    const scroller = document.getElementById("gallery");
    scroller.innerHTML = "";

    if (!images || !images.length){
      scroller.innerHTML = `<div class="card pad"><p class="p">Este producto no tiene fotos cargadas.</p></div>`;
      return;
    }

    images.forEach((name, i) => {
      const wrap = document.createElement("div");
      wrap.className = "shot";

      const img = document.createElement("img");
      img.src = IMG_BASE + name;
      img.alt = "Foto " + (i + 1);
      img.loading = "lazy";

      img.onerror = () => {
        // si falla, lo quitamos para que no quede blanco
        wrap.remove();
      };

      wrap.appendChild(img);
      scroller.appendChild(wrap);
    });

    // Si todas fallaron, avisamos
    setTimeout(() => {
      if (scroller.children.length === 0){
        scroller.innerHTML = `<div class="card pad"><p class="p">No se encontraron las fotos. Revisa nombres y carpeta <strong>assets/img/tablas/</strong>.</p></div>`;
      }
    }, 700);
  }

  async function init(){
    const debug = document.getElementById("debugLine");

    if(!id){
      document.getElementById("prodTitle").textContent = "Producto no encontrado";
      document.getElementById("prodDesc").textContent = "Falta el parámetro ?id=BS-XXX en la URL.";
      debug.textContent = `URL esperada: producto.html?id=BS-001 (ejemplo)`;
      return;
    }

    debug.textContent = `ID recibido: ${id} · JSON: ${DATA_URL} · IMG: ${IMG_BASE}`;

    const res = await fetch(DATA_URL, { cache: "no-store" });
    const all = await res.json();

    const p = all.find(x => (x.id || "").trim() === id);

    if(!p){
      document.getElementById("prodTitle").textContent = "Producto no encontrado";
      document.getElementById("prodDesc").textContent =
        `No existe "${id}" en products.json (revisa que el id coincida exacto).`;
      return;
    }

    document.title = `${p.id} — ${p.title} | Blacksheep by CAVS`;

    document.getElementById("prodCode").textContent = p.id;
    document.getElementById("prodTitle").textContent = p.title;
    document.getElementById("prodDesc").textContent = p.description || "";

    document.getElementById("prodStatus").textContent = p.status || "—";
    document.getElementById("prodPrice").textContent = formatCLP(Number(p.price || 0));
    document.getElementById("prodWood").textContent = p.wood || "—";
    document.getElementById("prodResin").textContent = p.resin || "—";
    document.getElementById("prodMeasures").textContent = p.measures || "—";

    const msg = `Hola! Me interesa la tabla ${p.id} (${p.title}). ¿Sigue disponible?`;
    document.getElementById("waBtn").href =
      `https://wa.me/56973765456?text=${encodeURIComponent(msg)}`;

    renderGallery(p.images);
  }

  init().catch(err => {
    console.error(err);
    document.getElementById("prodTitle").textContent = "Error cargando producto";
    document.getElementById("prodDesc").textContent = "Revisa la consola y la ruta a products.json.";
    document.getElementById("debugLine").textContent = String(err);
  });
</script>

</body>
</html>
